<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>django-lifecycle</title>
		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
<link rel="stylesheet" href="dist/theme/white.css" id="theme">
		<!-- Theme used for syntax highlighted code -->
<link rel="stylesheet" href="plugin/highlight/routeros.min.css" id="highlight-theme"></head>
	<body>
		<div class="reveal">
			<div class="slides">
<section data-markdown  ><textarea data-template>


Enrique Soria

# django-lifecycle

Descubriendo cómo gestionar en Django el ciclo de vida de un modelo, _sin pelos ni señales_

</textarea></section>
<section data-markdown  ><textarea data-template>

### Nuestro proyecto

Vamos a suponer que estamos creando un blog.

Nuestro blog tiene publicaciones.

</textarea></section>
<section data-markdown  ><textarea data-template>

### Nuestro proyecto

```python [4-7]
from django.db import models


class Post(models.Model):
    title = models.CharField(max_length=32)
    slug = models.SlugField(max_length=32)
    body = models.TextField()
```

</textarea></section>
<section data-markdown  ><textarea data-template>

### Objetivo

Setear el _slug_ de nuestro flamante blog automáticamente a partir del título.


</textarea></section>
<section data-markdown  ><textarea data-template>

### Usando django-lifecycle

Añadimos el mixin de lifecycle a nuestro modelo

```python [3, 6]
from django.db import models
from django.utils.text import slugify
from django_lifecycle import LifecycleModelMixin


class Post(LifecycleModelMixin, models.Model):
    title = models.CharField(max_length=32)
    slug = models.SlugField(max_length=32)
    body = models.TextField()
```

</textarea></section>
<section data-markdown  ><textarea data-template>

### Usando django-lifecycle

Creamos una función que calcule y setee el slug

```python [6-7]
class Post(LifecycleModelMixin, models.Model):
    title = models.CharField(max_length=32)
    slug = models.SlugField(max_length=32)
    body = models.TextField()

    def set_slug(self):
        self.slug = slugify(self.title)
```


</textarea></section>
<section data-markdown  ><textarea data-template>

### Usando django-lifecycle

Ahora le indicamos [en qué momentos](https://rsinger86.github.io/django-lifecycle/hooks_and_conditions/#lifecycle-moments) se quieren realizar estas acciones:

```python [3-4]
class Post(LifecycleModelMixin, models.Model):

    @hook(BEFORE_CREATE)
    @hook(BEFORE_UPDATE)
    def set_slug(self):
        self.slug = slugify(self.title)
```

</textarea></section>
<section data-markdown  ><textarea data-template>

### Usando django-lifecycle

También podemos especificar [en qué condiciones se ejecutan los hooks](https://rsinger86.github.io/django-lifecycle/hooks_and_conditions/#conditions).

```python [3-6]
class Post(LifecycleModelMixin, models.Model):

    @hook(BEFORE_CREATE)
    @hook(
        BEFORE_SAVE, condition=WhenFieldHasChanged("title") | WhenFieldValueIs("slug", value=None)
    )
    def set_slug(self):
        self.slug = slugify(self.title)
```


</textarea></section>
<section data-markdown  ><textarea data-template>

# Nuevos requerimientos

 - Impedir publicaciones sobre javascript en nuestro blog

</textarea></section>
<section data-markdown  ><textarea data-template>

## Custom conditions

Si las condiciones que existen no nos convencen podemos crear nuestras propias condiciones:

```python [9-11]
from django_lifecycle.conditions.base import ChainableCondition


class WhenFieldContains(ChainableCondition):
    def __init__(self, field_name, contains_value):
        self.field_name = field_name
        self.contains_value = contains_value
    
    def __call__(self, instance, update_fields=None):
        field_value = getattr(instance, self.field_name)
        return self.contains_value in field_value
```

</textarea></section>
<section data-markdown  ><textarea data-template>

## Custom conditions

Si las condiciones que existen no nos convencen podemos crear nuestras propias condiciones:

```python [3]
class Post(LifecycleModelMixin, models.Model):
    
    @hook(BEFORE_SAVE, condition=WhenFieldContains("title", "javascript"))   
    def avoid_artificial_intelligence_posts(self):
        raise Exception("¡Los artículos sobre javascript están prohibidos en esta casa!")
```

</textarea></section>
<section data-markdown  ><textarea data-template>

## Conclusión

La librería django-lifecycle nos permite, de forma declarativa, crear una serie de acciones asociadas al
ciclo de vida de un modelo Django.

https://rsinger86.github.io/django-lifecycle/

![](https://www.codigos-qr.com/qr/php/qr_img.php?d=https%3A%2F%2Fgithub.com%2Frsinger86%2Fdjango-lifecycle&s=8&e=m)


</textarea></section>
<section data-markdown ><textarea data-template>

# Enrique Soria

- Github: [@EnriqueSoria](https://github.com/EnriqueSoria)
- Twitter: [@esoria_dev](https://twitter.com/esoria_dev)
- Mastodon: [@esoria_dev@mastodon.social](https://mastodon.social/@esoria_dev)
- [Enrique Soria Magraner](https://www.linkedin.com/in/enriquesoriamagraner/) en Linkedin
</textarea></section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script src="plugin/math/math.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
Reveal.initialize({
controls : false,
markdown : {smartypants: true},
width : 1600,
height : 900,
				hash: true,
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath ]
			});
		</script>
	</body>
</html>
